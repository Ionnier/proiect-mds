<!DOCTYPE html>
<html>

<head>
    <title>Room - <%- room.roomName %>
    </title>
    <%- include("./fragments/head.ejs") %>
        <script>
            function showForm() {
                document.getElementById('inviteForm').style.display = 'block'
                document.getElementById('showInviteForm').style.display = 'none'
            }
            function hideForm() {
                document.getElementById('inviteForm').style.display = 'none'
                document.getElementById('showInviteForm').style.display = 'block'
            }
        </script>
</head>

<body>
    <%- include("./fragments/header.ejs") %>
        <main>
            <h3>
                <%- room.roomName %>
            </h3>
            <!-- TODO: Room Options (Roll Service) -->
            <% if(room.idUserUsersRoomparticipants.length>1){ %>
                <div class="participants">
                    <p>Other members of <%- room.roomName%>: </p>
                    <% const current_privilege = room.idUserUsersRoomparticipants.find(obj => {return obj.idUser == user.idUser}).roomparticipants %>
                    <% for(let member of room.idUserUsersRoomparticipants){ %>
                        <% if(member.idUser !=user.idUser){ %>
                            <!-- TODO: Room Options (Promote / Kick Users) -->
                            <div class="participant>" id="participant_div<%- member.idUser%>" tabindex="-1">
                                <p>
                                    <%- `${member.userFirstName} ${member.userLastName} -
                                        ${member.roomparticipants.roomRole}`%>
                                </p>
                                <% if(getValueOfPrivilege(current_privilege.roomRole) != 0 && testPrivilege(current_privilege.roomRole, member.roomparticipants.roomRole)){%>
                                    <style>
                                        #<%-`user_menu${member.idUser}`%> {
                                            display: none;
                                        }
                                        #<%-`participant_div${member.idUser}`%>:active #<%-`user_menu${member.idUser}`%>,
                                        #<%-`participant_div${member.idUser}`%>:focus #<%-`user_menu${member.idUser}`%> {
                                            display: block;
                                        }
                                    </style>
                                <nav id="user_menu<%- member.idUser%>">
                                    <ul>
                                        <% if(getValueOfPrivilege(current_privilege.roomRole)==2 && getValueOfPrivilege(member.roomparticipants.roomRole)==0){%>
                                        <li>
                                            <button>Promote User</button>
                                        </li>
                                        <%} else if(getValueOfPrivilege(current_privilege.roomRole)==ownerLevel) {%>
                                            <li>
                                                <button>Transfer Ownership</button>
                                            </li>
                                            <%} %>
                                        <li>
                                            <button onclick="if (confirm('Remove User?')) ">Remove User</button>
                                        </li>
                                        <li>
                                            <button onclick="alert('TODO')">View User</button>
                                        </li>
                                    </ul>
                                </nav>
                                <%} %>
                                
                            </div>
                            <%} %>
                                <%} %>

                </div>
                <%} else{ %>
                    <p>There are curently no other users in this room. You should invite someone!</p>
                    <%} %>
                        <input type="button" id="showInviteForm" value="Add other memebers" onclick="showForm()" />
                        <div id="inviteForm" style="display: none;">
                            <input type="text" id="memberContactInfo">
                            <!-- TODO: Room Options (Handle events) -->
                            <input type="button" value="Send" onclick="alert('TODO:')" />
                            <input type="button" value="Cancel" onclick="hideForm()" />


                        </div>
        </main>

</body>

</html>